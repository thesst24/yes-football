<div class="container">
  <header *ngIf="sessionData">
    <div class="pre-title">
      <a routerLink="/season"><i class="pi pi-angle-left"></i></a>
      <p>
        {{ sessionData.name }}
        :
        {{ sessionData.date | date: 'yyyy/MM/dd' }}
      </p>
    </div>

    <div class="search">
      <i class="pi pi-search icon-search"></i>
      <input
        type="text"
        placeholder="Search..."
        [(ngModel)]="searchText"
        (input)="filterMembers()"
      />
    </div>

    <div class="add-trial">
      <button class="btn-add-trial">
        <i class="pi pi-plus-circle"></i>
        Add Trial
      </button>
    </div>
  </header>

  <div class="content-con">
    <div class="content">
      <div class="club-member">
        <div class="title">
          <h2>Club Members:</h2>
          <p>({{ activeMembers }} / {{ totalMembers }})</p>
        </div>
        <div class="all-member">
          <div class="list-member">
            <div class="member" *ngFor="let list of filteredMembers" (click)="open(list)">
              <div class="image-profile">
                <img
                  *ngIf="list.image"
                  [src]="'http://localhost:3000' + list.image"
                  alt="profile"
                />
              </div>
              <p>{{ list.fullname }}</p>
            </div>
          </div>

          <!-- Scroll -->

          <!-- <div class="scroll-con">
                <div class="scroll"></div>
                <div class="slide"></div>
            </div> -->
        </div>
      </div>
    </div>

    <div class="content">
      <div class="participants">
        <div class="title-parti">
          <h2>Participants</h2>
          <div class="content-par"><p class="roster">
            <i class="pi pi-circle-on icon-roster"></i>Roster: {{ participants.length }} /
            {{ totalMembers }}
          </p>
          <p class="btn-remove-all" *ngIf="!isPastSession" (click)="confirmRemoveAll()">
    Remove All
  </p>
  </div>

          <!-- ✅ Remove All Button -->
  
        </div>

        <div class="list-member">
          <div class="member" *ngFor="let p of filteredParticipants" (click)="openParticipant(p)">
            <div class="image-profile">
              <img *ngIf="p.image" [src]="'http://localhost:3000' + p.image" />
            </div>
            <p>{{ p.fullname }}</p>

            <span class="badge" [ngClass]="p.status">
              {{ p.status }}
            </span>
          </div>
        </div>

        <!-- Scroll bar -->
        <!-- <div class="scroll-con">
                <div class="scroll"></div>
                <div class="slide"></div>
            </div> -->
      </div>
    </div>
  </div>
</div>

<!-- ✅ POPUP -->
<div class="popup-overlay" *ngIf="selectedMember">
  <div class="popup-box">
   
    <div class="box-img-popup">
    <img class="img-popup"
      *ngIf="selectedMember.image"
      [src]="'http://localhost:3000' + selectedMember.image"
      width="120"
    />
    </div>
 <h2>{{ selectedMember.fullname }}</h2>
    <p>Whatsapp: {{ selectedMember.whatsapp }}</p>

    <!-- ✅ JOIN MODE -->
    <button
  *ngIf="popupMode === 'join' && !isPastSession"
  class="btn-join"
  (click)="joinMember()"
>
  ✅ JOIN
</button>

<p *ngIf="isPastSession" class="text-red-500 mt-2">
  Past Session: Attendance Only
</p>
    <!-- ✅ REMOVE MODE -->
    <button *ngIf="popupMode === 'remove'" class="btn-remove" (click)="removeMember()">
       REMOVE
    </button>

    <button class="btn-close" (click)="closePopup()">✕</button>
  </div>
</div>

<!-- ✅ Confirm Remove All Popup -->
<div class="popup-overlay" *ngIf="showConfirmRemoveAll">
  <div class="popup-box">

    <h2>⚠️ Remove All Participants?</h2>

    <p>
      คุณแน่ใจหรือไม่ว่าต้องการลบ Participants ทั้งหมดออกจาก Session นี้?
    </p>

    <div class="popup-actions">
      <button class="btn-remove" *ngIf="!isPastSession" (click)="removeAllParticipants()">
        ✅ Yes, Remove All
      </button>

      <button class="btn-close" (click)="showConfirmRemoveAll = false">
        Cancel
      </button>
    </div>

  </div>
</div>
