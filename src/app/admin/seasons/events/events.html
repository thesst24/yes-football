<div class="container">
  <header *ngIf="sessionData">
    <div class="pre-title">
      <a routerLink="/season"><i class="pi pi-angle-left"></i></a>
      <p>
        <strong>{{ sessionData.name }}</strong> : {{ sessionData.date | date: 'yyyy/MM/dd' }}
      </p>
    </div>

    <div class="search">
      <i class="pi pi-search icon-search"></i>
      <input
        type="text"
        placeholder="Search member..."
        [(ngModel)]="searchText"
        (input)="filterMembers()"
      />
    </div>

    <button class="btn-add-trial" (click)="openTrialPopup()">
      <i class="pi pi-plus-circle"></i> Add Trial
    </button>
  </header>

  <main class="content-con">
  <section class="content-card">
  <div class="title">
    <h2>Club Members <span class="memberofall">({{ activeMembers }} / {{ totalMembers }})</span></h2>
  </div>
  
  <div class="member-grid">
    <div class="member-item" *ngFor="let list of filteredMembers" (click)="open(list)">
      <img [src]="list.image ? 'http://localhost:3000' + list.image : '/logo.png'" class="member-avatar" />
      <p class="member-name">{{ list.fullname }}</p>
      <span *ngIf="list.isTrial" class="badge trial">Trial</span>
    </div>
  </div>
</section>

    <section class="content-card">
      <div class="content-par">
        <h2>Participants</h2>
        <button
          class="btn-remove-all"
          *ngIf="!isPastSession && participants.length > 0"
          (click)="confirmRemoveAll()"
        >
          Remove All
        </button>
      </div>
      <p class="roster">
        <i class="pi pi-circle-on icon-roster"></i> Roster: {{ participants.length }} /
        {{ totalMembers }}
      </p>

      <div class="member-grid">
        <div
          class="member-item"
          *ngFor="let p of filteredParticipants"
          (click)="openParticipant(p)"
        >
          <img
            [src]="p.image ? 'http://localhost:3000' + p.image : '/logo.png'"
            class="member-avatar"
          />
          <p class="member-name">{{ p.fullname }}</p>
        </div>
      </div>
    </section>
  </main>
</div>

<div class="popup-overlay" *ngIf="selectedMember">
  <div class="popup-box">
    <button class="btn-close" (click)="closePopup()">✕</button>

    <div class="popup-header">
      <img
        [src]="selectedMember.image ? 'http://localhost:3000' + selectedMember.image : '/logo.png'"
        class="popup-avatar"
      />
      <div class="popup-info">
        <h2 class="popup-name">{{ selectedMember.fullname }}</h2>
        <p class="popup-phone">{{ selectedMember.whatsapp }}</p>
        <span *ngIf="popupMode === 'remove'" class="badge" [ngClass]="selectedMember.status">
          {{ selectedMember.status }}
        </span>
      </div>
    </div>

    <ng-container [ngSwitch]="popupMode">
      <div *ngSwitchCase="'join'">
        <button
          *ngIf="!isAlreadyParticipant(selectedMember._id)"
          class="btn-base btn-join"
          (click)="joinMember()"
        >
          JOIN
        </button>
        <p *ngIf="isAlreadyParticipant(selectedMember._id)" class="already">✅ Already Joined</p>
      </div>

      <div *ngSwitchCase="'remove'">
        <button class="btn-base btn-remove" (click)="removeMember()">REMOVE</button>
      </div>
    </ng-container>
  </div>
</div>
